# Verification: D-01 Tenancy diagnostic logging

**Purpose:** Capture evidence that `/patient/get-data` still returns both clinics’ patients even after switching, proving Bucket A (unscoped reads). Diagnostic logging (`[TENANT-DIAG]`) was added briefly but was unreliable under Windows/XAMPP, so the verified proof comes from the JSON payload itself.

## Setup
1. Start the app (Windows/XAMPP or WSL). The logging flag is optional because the definitive evidence is in the response payload.
2. (Optional) Tail `writable/logs/log-*.log` and watch for `[TENANT-DIAG]` lines—these may not appear consistently on Windows.

## Reproduction Steps (browser only)
1. Log in as an admin user who belongs to both Clinic A and Clinic B.
2. Select **Clinic A** via `/clinic/select` and create a test patient “Patient A”.
3. Switch to **Clinic B** using `/clinic/switch` (or the dropdown link).
4. Hit `/patient/get-data` (via the DataTables grid or a `curl -X POST http://localhost/patient/get-data`).
5. Observe the JSON response: it lists every patient (including “Patient A”) and metadata (`recordsTotal`/`recordsFiltered`) that reflect the combined count, proving the query is unscoped.

## JSON Evidence
Sample response (Clinic B active):
```
{
  "draw": 1,
  "recordsTotal": 37,
  "recordsFiltered": 37,
  "data": [
    // Patient A (from Clinic A) is still present
    // Patient B (Clinic B) appears as normal
  ]
}
```
Switch back to Clinic A and confirm the `recordsTotal`/`recordsFiltered` values change to Clinic A’s count (and Clinic B’s patients disappear from the `data` array). This proves the leak is in the read path (Bucket A).

## Diagnostic logging note
- `[TENANT-DIAG]` instrumentation was added and then removed (Task D-03). The logs were inconsistent on Windows, so the payload above serves as the final proof.

## Cleanup
1. No action needed—the instrumentation was removed after capture.
2. Continue with Phase 4 query scoping (S4-02b etc.), addressing the raw query allowlist entries for patient/finance/etc.
