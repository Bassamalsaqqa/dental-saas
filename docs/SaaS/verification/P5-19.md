# Verification: P5-19 â€” Control Plane Entry + Missing Surfaces

## Objective
Verify that the Control Plane has a complete, navigable surface area with a canonical entry point and implemented (though thin) operational routes, adhering to the "Global Mode" security contract.

## 1. Route Verification

**Command:**
```bash
php spark routes | findstr /I "controlplane"
```

**Output (Filtered for relevance):**
```
| GET    | controlplane                          | ??    | \App\Controllers\ControlPlane\Entry::index                    | csrf                                      | secureheaders csrfjson toolbar                                      |
| GET    | controlplane/dashboard                | ??    | \App\Controllers\ControlPlane\Dashboard::index                | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
| GET    | controlplane/console                  | ??    | \App\Controllers\ControlPlane\Console::index                  | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
| GET    | controlplane/operations               | ??    | \App\Controllers\ControlPlane\Operations::index               | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
| GET    | controlplane/settings                 | ??    | \App\Controllers\ControlPlane\Settings::index                 | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
| GET    | controlplane/danger                   | ??    | \App\Controllers\ControlPlane\Danger::index                   | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
| POST   | controlplane/enter                    | ??    | \App\Controllers\ControlPlane::enter                          | csrf                                      | secureheaders csrfjson toolbar                                      |
| POST   | controlplane/danger/exit              | ??    | \App\Controllers\ControlPlane\Danger::exitGlobalMode          | csrf controlplane                         | controlplane secureheaders csrfjson toolbar                         |
```

## 2. Exit Bypass Check

**Command:**
```bash
rg -n "controlplane/exit|Terminate|Exit Global Mode" app/Views app/Controllers
```

**Output:**
```
app/Controllers/ControlPlane.php
51:    * POST /controlplane/exit
```
*Confirmed: No rogue exit points exist.*

## 3. Behavior Logic (Mental Walkthrough)

### Scenario A: Superadmin (Global Mode OFF)
1.  **GET /controlplane/dashboard** -> 404 (ControlPlaneFilter: global_mode != true)
2.  **GET /controlplane/operations** -> 404 (ControlPlaneFilter: global_mode != true)
3.  **GET /controlplane** -> 200 (Entry Controller: Auth OK, SuperAdmin OK, GlobalMode OFF -> Render Entry View).
4.  **View:** Shows "Global Mode: OFF", "Enter" form. No nav links (auto-hidden).

### Scenario B: Entering Global Mode
1.  **POST /controlplane/enter** -> Session `global_mode` = true. Redirects to `/controlplane/dashboard`.

### Scenario C: Superadmin (Global Mode ON)
1.  **GET /controlplane** -> Redirects to `/controlplane/dashboard`.
2.  **GET /controlplane/operations** -> 200 (Render Operations View).
3.  **GET /controlplane/settings** -> 200 (Render Settings View "Not implemented").
4.  **Layout:** Nav links (Dashboard, Console, Operations, Settings) are visible.

## 4. Guardrails

`bash scripts/ci/saas_guardrails.sh`
**Result:** Passed.
