# Verification: S0-02 - SaaS CI Guardrails

**Task ID:** S0-02  
**Objective:** Implement a repeatable guardrail so CI rejects DOM sinks, raw tenant table queries, and legacy group-based auth checks before code merges.

## Pre-requisites
- `bash` + `rg` must be available in the CI host (the script is a Bash helper that relies on `rg`).
- Run the command from the repository root so the guardrail plug-in can read `docs/SaaS/guardrails/*.allowlist`.

## Verification Steps

1.	Execute the SaaS guardrail script.

```bash
bash scripts/ci/saas_guardrails.sh
```

Expected output fragments:
```
Guardrail 'DOM sinks in app/Views' passed (0 match(es)).
Guardrail 'Group-based auth helpers' passed (1 match(es)).
Guardrail 'Raw tenant queries in controllers' passed (34 match(es)).
SaaS guardrail validation succeeded.
```

2.	If the script prints unexpected matches, address the flagged files and remove the corresponding lines from `docs/SaaS/guardrails/<category>.allowlist`.

## Recognition Points
- `docs/SaaS/guardrails/dom-sinks.allowlist` tracks known `innerHTML/outerHTML/insertAdjacentHTML/.html(` hits.
- `docs/SaaS/guardrails/group-auth.allowlist` documents the remaining `is_admin` test artifact.
- `docs/SaaS/guardrails/raw-tenant-queries.allowlist` lists every allowed `->table` or `db->query` usage that future refactors must eliminate.

## Results
- [ ] Guardrail script runs cleanly (`exit 0`) and prints the “passed” messages.
- [ ] Unexpected matches are either fixed or intentionally added to an allowlist entry with a short comment.

## 2026-01-14 – Guardrail Verification (S0-02)
- Commit: `d33502d` (origin/main)
- Command: `bash scripts/ci/saas_guardrails.sh`
- Environment: WSL Ubuntu (ripgrep 14.1.0, bash 5.2.21)
- Output:
  Guardrail 'DOM sinks in app/Views' passed (0 match(es)).
  Guardrail 'Group-based auth helpers' passed (1 match(es)).
  Guardrail 'Raw tenant queries in controllers' passed (40 match(es)).
  SaaS guardrail validation succeeded.
