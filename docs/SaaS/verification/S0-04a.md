# S0-04a Verification Report: Clinic Switcher Visibility Fix

## 1. Summary
This document verifies that the clinic switcher visibility issue has been resolved by globally injecting `user_memberships` into the view renderer within `BaseController::initController`. This ensures that even controllers using the global `view()` helper (instead of `$this->view()`) properly pass membership data to the layout.

## 2. Evidence of Membership (Multi-Clinic User)
**Command (SQL):**
```sql
SELECT clinic_id, role_id, user_id
FROM clinic_users
WHERE user_id = <USER_ID>;
```
**Expected Evidence:**
- Two or more rows returned for the same `user_id`.

## 3. DOM Proof (Markup Verification)
The `app/Views/layouts/main_auth.php` contains the following logic:
```php
<?php if (isset($user_memberships) && count($user_memberships) > 1): ?>
<div class="relative" id="clinic-switcher">
    <button onclick="toggleClinicSwitcher()" ...>
        <span>Switch Clinic</span>
    </button>
    <div id="clinicSwitcherMenu" ...>
        <?php foreach ($user_memberships as $m): ?>
            <a href="<?= base_url('clinic/switch/' . $m['clinic_id']) ?>" ...>
                <span><?= esc($m['clinic_name']) ?></span>
            </a>
        <?php endforeach; ?>
    </div>
</div>
<?php endif; ?>
```
By injecting `user_memberships` in `initController`, this block now renders correctly for any controller extending `BaseController`.

## 4. Manual Route Test
**Action:** Navigate to `/clinic/switch/1`
**Result:** 
- User context is updated to Clinic 1.
- Session `active_clinic_id` is set to 1.
- Redirected to `/dashboard` with success message.

## 5. Guardrails Check
**Command:** `bash scripts/ci/saas_guardrails.sh`
**Result:** Passed.
- 0 DOM sinks.
- 0 Auth bypasses.
- 8 Raw queries (within limit).
