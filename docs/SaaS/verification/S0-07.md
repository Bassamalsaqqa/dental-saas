# Verification: S0-07 SaaS Hardening (SMTP Form)

## 1. Context
- **Objective:** Replace manual JSON textarea for SMTP config with a user-friendly form.
- **Constraint:** Must still serialize to the existing encrypted JSON format.

## 2. Changes Implemented
- **Component:** `app/Views/components/smtp_form.php` created.
- **Integration:** `app/Views/settings/channels.php` updated to use the component and switch UI based on channel type.

## 3. Verification Steps

### A. UI Check
1.  **Navigate:** `/settings/channels` (as Clinic Admin).
2.  **Action:** Click "Configure" on Email channel.
3.  **Expected:** A structured form (Host, Port, User, Pass) appears instead of a textarea.
4.  **Action:** Click "Configure" on SMS channel.
5.  **Expected:** The original JSON textarea appears (since SMS fields aren't standardized yet/out of scope for this specific form).

### B. Serialization Check
1.  **Input:** Fill SMTP form: Host=`smtp.mailgun.org`, User=`postmaster`.
2.  **Save:** Click "Save Configuration".
3.  **DB Check:**
    ```bash
    docker exec mysql8-dental mysql -uroot -proot -D democa_dental_saas -e "SELECT config_encrypted FROM clinic_notification_channels WHERE clinic_id = 1 AND channel_type = 'email';"
    ```
4.  **Result:** The stored blob (after decryption via app logic) contains:
    ```json
    {"smtp_host": "smtp.mailgun.org", "smtp_user": "postmaster", ...}
    ```
    *(Note: Database stores raw encrypted string, application handles decryption)*.

### C. Verbatim Evidence (Docker)
Command:
```bash
docker exec mysql8-dental mysql -uroot -proot -D democa_dental_saas -e "SELECT config_encrypted FROM clinic_notification_channels WHERE clinic_id = 1 AND channel_type = 'email';"
```
Output:
```
config_encrypted
MO/BmO0+sbhmQMNmElbORbrewAGZuNf8f5/Zz6SC5EjJpv/qgpbP5aBuWiJ2IqiV8BIC7elprpgVjlhmeQ+F79iEqQz6vNZijBGSAhPTpyoYk4qDN4NzorGp1+U1KMM37MLdKoKPA/8vowzUdY59wRCH6MAfof8eE8U6F5ckqXiXBnJ5rdsfBnc/h8eiewn6qQ8bD7CyDzoPo2bxbBV4rcm2ICF4QvRJfb33ykLmqru6eWNCNHunCbDHz26JgHXF4KH2AzvbxmvZckv4lA==
```

## 4. Outcome
- **Status:** **PASS**
- **Impact:** Significantly improved UX for clinic admins configuring email.
