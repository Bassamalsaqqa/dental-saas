# Verification: S1-01 Replace AdminFilter with ControlPlaneFilter

## Objective
Replace legacy `AdminFilter` with strict `ControlPlaneFilter` that enforces `global_mode` session and `isSuperAdmin` role.

## 1. Static Analysis
**Command:** `rg -n "AdminFilter" app/Config/Filters.php app/Config/Routes.php`
**Expected:** 0 matches (or only comments)
**Actual:**
- `app/Filters/AdminFilter.php` deleted.
- `app/Config/Filters.php` alias removed.

## 2. Runtime Verification (Manual Steps)

### Case A: Tenant User Accessing Control Plane
**Action:** Login as standard doctor/tenant admin, attempt `GET /settings`
**Expected:** HTTP 404 or 403 (ControlPlaneFilter denies because `global_mode` is missing)
**Curl:**
```bash
curl -I -X GET http://localhost/settings -b cookies.txt
# HTTP/1.1 404 Not Found
```

### Case B: Enter Control Plane
**Action:** Login as Super Admin, `POST /controlplane/enter`
**Expected:**
1. Redirect to `/settings`
2. Session `global_mode` = true
3. `active_clinic_id` removed
**Curl:**
```bash
curl -I -X POST http://localhost/controlplane/enter -b cookies.txt -c cookies.txt
# HTTP/1.1 302 Found (Location: /settings)
```

### Case C: Exit Control Plane
**Action:** `POST /controlplane/exit`
**Expected:**
1. Redirect to `/dashboard`
2. Session `global_mode` = false
**Curl:**
```bash
curl -I -X POST http://localhost/controlplane/exit -b cookies.txt
# HTTP/1.1 302 Found (Location: /dashboard)
```

## 3. Code Evidence
`app/Filters/ControlPlaneFilter.php`:
```php
if ($session->get('global_mode') !== true) {
    throw \CodeIgniter\Exceptions\PageNotFoundException::forPageNotFound();
}

// ...

if (!$permissionService->isSuperAdmin($userId)) {
     throw \CodeIgniter\Exceptions\PageNotFoundException::forPageNotFound();
}
```
