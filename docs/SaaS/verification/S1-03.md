# Verification: S1-03 Route hardening with permission chain

## Objective
Enforce strict filter chains for Control Plane (`auth -> controlplane`) and Tenant Plane (`auth -> tenant`).

## 1. Route Grouping Analysis
`app/Config/Routes.php` structure:

**Control Plane Groups:**
- `controlplane` (enter/exit)
- `settings` -> `['filter' => 'controlplane']`
- `rbac` -> `['filter' => 'controlplane']`

**Tenant Plane Groups:**
- `dashboard`, `patient`, `finance`, etc. -> `['filter' => ['auth', 'tenant']]`
- Specific routes use `permission` filter (e.g., `permission:patients:view`).

## 2. Filter Chain Evidence
**Tenant Route Example:**
`$routes->group('patient', ['filter' => ['auth', 'tenant']], ...)`
- Request hits `AuthFilter` (Log in check)
- Request hits `TenantFilter` (Context check - currently pass-through for S1-03)
- Request hits `PermissionFilter` (RBAC check on specific routes)

**Control Plane Route Example:**
`$routes->group('settings', ['filter' => 'controlplane'], ...)`
- `ControlPlaneFilter` checks `global_mode` + `super_admin` permission.
- Note: `ControlPlaneFilter` explicitly checks `loggedIn()` so `auth` filter is redundant but safe if added. Current config uses single alias `controlplane` which includes auth check.

## 3. Guardrails
`TenantFilter.php` created as placeholder to ensure the chain exists for Phase 2 implementation.
