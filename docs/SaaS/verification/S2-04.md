# Verification: S2-04 TenantFilter enforcement

## Objective
Prevent access to tenant resources without active, valid tenant context.

## 1. Filter Logic (`TenantFilter.php`)
- **Missing Context:**
    - API: Returns JSON 403 `{"error": "TENANT_CONTEXT_REQUIRED"}`.
    - HTML: Redirects to `/clinic/select`.
- **Invalid Context (Tampered/Expired):**
    - Checks `active_clinic_id` against `clinic_users`.
    - If not found: Clears session, returns 403 (JSON or HTML redirect).
- **Role Enforcement:**
    - Overwrites `active_clinic_role_id` in session with DB value to prevent privilege escalation via session tampering.

## 3. Guardrail Verification
- **Status:** PASS
- **Command:** `rg -n "clinic_users" app/Controllers`
- **Result:** 0 matches (All memberships queries moved to `ClinicService` and `ClinicUserModel`).
- **Scope Creep Check:** `scripts/reset_password_cli.php` deleted.

## 4. Commit Hash
`1dbd0490b04aa84114fc92cd304c00f4fbda4994`
