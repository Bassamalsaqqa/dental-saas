# Verification: S3-04 Write-Path Enforcement

## Objective
Ensure `clinic_id` is automatically set on INSERT.

## 1. Implementation
**File:** `app/Traits/TenantTrait.php`
**Logic:**
```php
    protected function setClinicId(array $data)
    {
        $session = service('session');
        $clinicId = $session->get('active_clinic_id');

        if ($clinicId && !isset($data['data']['clinic_id'])) {
            $data['data']['clinic_id'] = $clinicId;
        }

        return $data;
    }
```

## 2. Model Integration
All tenant models (`PatientModel`, etc.) use `TenantTrait` and have `setClinicId` in `$beforeInsert`.

## 3. Raw Writes
- Controllers using `TenantBaseModel` (Phase 4) will be safe.
- Controllers using raw `$db->table()->insert()` (if any remaining) would fail NOT NULL check unless patched.
- `Auth` and `ClinicSelector` were refactored in Phase 2 fix.
- Other controllers (e.g. `Patient`) generally use Models.
