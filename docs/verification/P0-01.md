# Verification: P0-01 - Attack Surface Reduction (Containment)

**Task ID:** P0-01
**Objective:** Relocate dangerous web-accessible scripts to a non-web-accessible directory and enforce CLI-only execution.

## Pre-requisites
- Application must be running on a local or remote web server.
- The base URL should point to the `public/` directory as the document root (standard CI4) OR the repo root (legacy hosting).

## Verification Steps

### 1. Webroot Cleanup (public/)
The following scripts were moved from `public/` to `scripts/`. They should now return HTTP 404 (Not Found).

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/init_database.php` | 404 | |
| `/repair_db.php` | 404 | |
| `/repair_db_final.php` | 404 | |
| `/repair_db_standalone.php` | 404 | |
| `/check_users_table.php` | 404 | |
| `/simple_login_test.php` | 404 | |
| `/tailwind-test.html` | 404 | |

**Commands:**
```bash
curl -I http://localhost/init_database.php
curl -I http://localhost/repair_db.php
curl -I http://localhost/repair_db_final.php
curl -I http://localhost/repair_db_standalone.php
curl -I http://localhost/check_users_table.php
curl -I http://localhost/simple_login_test.php
curl -I http://localhost/tailwind-test.html
```

### 2. Repo Root Cleanup
The following scripts were moved from the repo root to `scripts/`.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/install.php` | 404 | |
| `/debug_env.php` | 404 | |

**Commands:**
```bash
curl -I http://localhost/install.php
curl -I http://localhost/debug_env.php
```

### 3. CLI-Only Enforcement (Repo-Root Docroot Scenario)
Even if the document root is set to the repository root (exposing the `scripts/` directory), direct access must fail. All scripts in `scripts/` have been updated to check `PHP_SAPI`.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/scripts/init_database.php` | 404/403 | |
| `/scripts/repair_db.php` | 404/403 | |
| `/scripts/install.php` | 404/403 | |
| `/scripts/check_users_table.php` | 404/403 | |

**Commands:**
```bash
curl -I http://localhost/scripts/init_database.php
curl -I http://localhost/scripts/repair_db.php
curl -I http://localhost/scripts/install.php
curl -I http://localhost/scripts/check_users_table.php
```

### 4. Repository Evidence
Run the following to confirm no dangerous scripts remain in `public/` or the root:

```powershell
Get-ChildItem public -Recurse -Filter "*.php"
Get-ChildItem . -Filter "*.php"
```

## Results
- [ ] All original endpoints return 404.
- [ ] Direct access to `/scripts/*.php` returns 404/403 (enforced via `PHP_SAPI`).
- [ ] No scripts left in `public/`.
- [ ] `__MACOSX` artifacts removed.
- [ ] Documentation updated.