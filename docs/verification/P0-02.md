# Verification: P0-02 - Block Sensitive Files at Web Server Level

**Task ID:** P0-02
**Objective:** Ensure sensitive files and directories are blocked by the web server (Apache/Nginx) regardless of the document root configuration.

## Pre-requisites
- Application must be running on a local or remote web server.
- `.htaccess` rules must be active (for Apache) or Nginx config applied.

## Verification Steps

### 1. Root-Level Sensitive Files (Repo-Root Docroot Scenario)
These files reside in the project root. Accessing them directly should return **403 Forbidden**.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/.env` | 403 | |
| `/environment.env` | 403 | |
| `/ENVIRONMENT` | 403 | |
| `/democa_dental.sql` | 403 | |
| `/composer.json` | 403 | |

**Commands:**
```bash
curl -I http://localhost/.env
curl -I http://localhost/environment.env
curl -I http://localhost/ENVIRONMENT
curl -I http://localhost/democa_dental.sql
curl -I http://localhost/composer.json
```

### 2. Sensitive Directories & Scripts (Repo-Root Docroot Scenario)
These directories and specific dangerous scripts must not be browsable or accessible.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/app/Config/Database.php` | 403 | |
| `/system/` | 403 | |
| `/writable/logs/` | 403 | |
| `/scripts/install.php` | 403/404 | |
| `/scripts/repair_db_final.php` | 403/404 | |
| `/scripts/repair_db_standalone.php` | 403/404 | |
| `/docs/installation.html` | 403 | |

**Commands:**
```bash
curl -I http://localhost/app/Config/Database.php
curl -I http://localhost/system/
curl -I http://localhost/writable/logs/
curl -I http://localhost/scripts/install.php
curl -I http://localhost/scripts/repair_db_final.php
curl -I http://localhost/docs/installation.html
```

### 3. Public Directory Checks (Standard Docroot Scenario)
Even if the docroot is correctly set to `public/`, these files should be blocked if they accidentally exist there.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/.env` (if exists in public) | 403 | |
| `/test.dump` (if exists in public) | 403 | |

**Commands:**
```bash
# Create dummy sensitive files in public/ to test protection (Delete after test!)
touch public/.env public/test.dump
curl -I http://localhost/.env
curl -I http://localhost/test.dump
rm public/.env public/test.dump
```

### 4. Application Availability (Regression Test)
Ensure legitimate access is **NOT** blocked.

| Endpoint | Expected Status | Actual Status |
| :--- | :--- | :--- |
| `/` | 200/302 | |
| `/assets/favicon.ico` | 200 | |

**Commands:**
```bash
curl -I http://localhost/
curl -I http://localhost/assets/favicon.ico
```

### 5. Repository Evidence
Confirm that sensitive files actually exist on disk (and thus require protection).

**PowerShell:**
```powershell
Get-ChildItem -Path . -Filter ".env*"
Get-ChildItem -Path . -Filter "*.sql"
Get-ChildItem -Path scripts -Filter "repair_db*.php"
```

**Bash:**
```bash
ls -la .env* *.sql scripts/repair_db*.php
```

## Results
- [ ] All sensitive root files return 403.
- [ ] All sensitive directories return 403.
- [ ] `repair_db*.php` variants are blocked (403/404).
- [ ] `.dump` extension is blocked (403).
- [ ] Public assets are accessible (200).
- [ ] Repository evidence confirms presence of sensitive files.
