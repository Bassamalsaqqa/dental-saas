# Task: P1-02a-V
Date: 2026-01-07 (document creation date; runtime evidence added 2026-01-08)
Status: BLOCKED (403 deferred; 401/302 captured)

## Scope Constraints
- Docs-only modification.
- No code or configuration changes were performed.
- This document does not claim a PASS status for runtime behavior.

## Runtime Evidence Status: BLOCKED
- HTTPS required (HTTP 307 redirect observed).
- curl uses -k due to untrusted local cert.
- 401 unauthenticated (JSON) captured.
- 302 non-API protected route captured.
- 403 authenticated-but-unauthorized deferred (no low-priv cookie jar yet).

## Pre-flight Repo State

### git branch --show-current
```text
main
```

### git rev-parse HEAD
```text
78eb7840dd19702e102c2a28eaeeba2818d0a6c9
```

### git status --porcelain
```text
```

## Environment (Runtime)

BASE_URL=https://localhost/dental-improvement

Notes:
- HTTPS required (HTTP 307 redirect observed).
- curl uses -k due to untrusted local cert.

## BASE_URL Sanity Check (Deferred)
Command (no -L, uses -k for HTTPS):
curl -k -i -sS --max-time 10 "${BASE_URL}/"

```text
NOT CAPTURED - not required for partial update
```

## Evidence Capture Commands

Unauth 401 JSON
```bash
curl -k -i -sS --max-time 10 -H "Accept: application/json" "${BASE_URL}/api/v1/patients"
```

Auth but unauthorized 403 JSON (cookie jar OUTSIDE repo)
```bash
curl -k -i -sS --max-time 10 -H "Accept: application/json" -b C:\Temp\p1-02a-v.cookies.txt "${BASE_URL}/api/v1/finances"
```

Non-API 302
```bash
curl -k -i -sS --max-time 10 "${BASE_URL}/patients"
```

Notes:
- Cookie jar must be stored outside repo to avoid extra files appearing in git status --porcelain.
- Do not use -L; redirects must remain visible.
- If API responses are HTML, add: -H "X-Requested-With: XMLHttpRequest" and record that change in the doc.

## Evidence (401 Unauthenticated API)
Cookie values are redacted.
```text
HTTP/1.1 401 Unauthorized
Date: Thu, 08 Jan 2026 11:01:48 GMT
Server: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
X-Powered-By: PHP/8.2.12
Set-Cookie: ci_session=<redacted>; expires=Thu, 08 Jan 2026 13:01:48 GMT; Max-Age=7200; path=/; secure; HttpOnly; SameSite=Lax
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Set-Cookie: csrf_cookie_name=<redacted>; expires=Thu, 08 Jan 2026 13:01:48 GMT; Max-Age=7200; path=/; secure; HttpOnly; SameSite=Lax
Content-Length: 27
Content-Type: application/json; charset=UTF-8

{"error":"unauthenticated"}
```

Status line: `HTTP/1.1 401 Unauthorized`  
Content-Type: `application/json; charset=UTF-8`  
JSON excerpt: `{"error":"unauthenticated"}`

## Evidence (302 Non-API Protected Route)
Cookie values are redacted.
```text
HTTP/1.1 302 Found
Date: Thu, 08 Jan 2026 11:01:48 GMT
Server: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
X-Powered-By: PHP/8.2.12
Set-Cookie: ci_session=<redacted>; expires=Thu, 08 Jan 2026 13:01:48 GMT; Max-Age=7200; path=/; secure; HttpOnly; SameSite=Lax
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, max-age=0, no-cache
Pragma: no-cache
Location: https://localhost/dental-improvement/auth/login
Content-Length: 0
Content-Type: text/html; charset=UTF-8
```

Status line: `HTTP/1.1 302 Found`  
Location: `https://localhost/dental-improvement/auth/login`

## Evidence (403 Authenticated-but-Unauthorized API) - DEFERRED
Blocked: no low-privileged authenticated user cookie jar is available.

Unblock requirements:
- Low-privileged user exists with no `finance:view`.
- Cookie jar stored outside repo (e.g., `C:\Temp\p1-02a-v.cookies.txt`).
- Do not paste cookie values or credentials into this doc.

## Next Steps / Unblock Conditions
- Capture 403 JSON using a low-privileged authenticated cookie jar.
- Paste raw output and update status to PASS/FAIL (once 403 evidence exists).
