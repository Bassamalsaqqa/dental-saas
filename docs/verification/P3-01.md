# Verification: P3-01 Notifications UI Remediation

This document verifies the removal of unsafe `innerHTML` sinks from the global notifications system in `main_auth.php`.

## 1. app/Views/layouts/main_auth.php

### displayNotifications Function
- **Original Sink:** Used `listElement.innerHTML` to render both empty states and the list of notifications (interpolating `title`, `message`, etc.).
- **Data Source:** AJAX response from `/api/notifications` (DB values).
- **Safe Replacement:** Refactored to use `document.createElement`, `textContent`, `document.createDocumentFragment()`, and `appendChild`.
- **Status:** REMEDIATED

## Behavior Preservation Notes
Do not modify these selectors or logic patterns, as they are relied upon by the refactored code:

- **List Container:** `document.getElementById('notifications-list')`
- **Click Navigation:** `onclick` handler calls `navigateToEntityFromNotification(type, id)`
- **Unread Indicator:** A `div` with class `w-2 h-2 bg-blue-500 rounded-full` is conditionally appended.
- **Empty State:** Checks `notifications.length === 0` and renders a specific icon/message structure.

## Evidence
- **Command:** `rg -n "innerHTML|\.html\(|insertAdjacentHTML|outerHTML" app/Views/layouts/main_auth.php`
- **Output:** (empty) - No remaining matches.

## Summary of Risk Reduction
- **XSS Prevention:** All notification content (titles, messages, user names) is now rendered as literal text via `textContent`. Any script tags injected into these fields in the database will be displayed as text and not executed.
- **Behavior:** The visual presentation (Tailwind classes, icons) and interactive behavior (click-to-navigate) remain identical to the original implementation.

## Polling / Timing Preservation Evidence
- **Refresh interval:** `setInterval(...)` runs every **30000 ms (30s)**.
  - Reference: `app/Views/layouts/main_auth.php` around line **1085** (verify exact line in your file).
- **Refresh backoff/deferral:** `setTimeout(...)` exists in refresh path.
  - Reference: `app/Views/layouts/main_auth.php` around line **1106** (verify exact line in your file).
- **Change statement:** P3-01 did not alter polling cadence or timing logic; only rendering was changed.
## Unread Count Update Contract
- Document the exact selector/ID used by the code to show/hide/update the unread badge/count.
- Source: `main_auth.php` notification count update function (verify selector from code, do not guess).
